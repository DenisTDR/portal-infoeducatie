@using MCMS.Base.Extensions
@model InfoEducatie.Contest.Judging.Judging.JudgingPageModel

@{
    ViewBag.Title = "Judging";
    ViewBag.HideFooter = true;
    ViewBag.MainContainerClasses = "p-0 flex-grow-1 d-flex flex-column";
}
<div class="container-fluid">
    <div class="row">
        <div class="mt-2"></div>
        <span>Judge name: <b>@Model.Judge.FullName</b> | </span>
        <span class="pl-2">Category: <b>@Model.Category.Name</b> | </span>
        <span class="pl-2">Projects: <b>@Model.Projects.Count</b> | </span>
        <span class="pl-2">Judging criteria: <b>@Model.JudgingCriteria.Count</b></span>
        <span class="pl-2">Initial set points: <b>@Model.InitialPoints.Count</b></span>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="alert alert-info d-inline-block mt-2">Punctajele se salvează automat după ce un input își pierde focusul. O notitficare de feedback va apărea în partea dreaptă.</div>
        </div>
    </div>
</div>
<div class="judging-table-wrapper flex-grow-1">
    <table class="table table-striped table-bordered judging-table">
        <thead>
        <tr>
            <th>Criteria</th>
            <th>Max Points</th>
            @foreach (var project in Model.Projects)
            {
                <th>
                    @project.Title
                    <a href="https://community.infoeducatie.ro/t/xyz/@project.OldPlatformId" target="_blank">
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                </th>
            }
        </tr>
        </thead>
        <tbody>
        @foreach (var criterion in Model.JudgingCriteria)
        {
            <tr>
                <td data-content="@Html.Raw(criterion.Description)" data-toggle="popover" class="crit-td">@criterion.Name</td>
                <td data-content="@Html.Raw(criterion.Description)" data-toggle="popover" class="crit-td">@criterion.MaxPoints</td>
                @foreach (var project in Model.Projects)
                {
                    <td data-project-id="@project.Id" data-criterion-id="@criterion.Id" class="for-input">
                        <input type="number" class="points-input" min="0" max="@criterion.MaxPoints"
                               value="@(Model.InitialPoints.FirstOrDefault(p => p.Project.Id == project.Id && p.Criterion.Id == criterion.Id)?.Points.ToString() ?? "")"/>
                    </td>
                }
            </tr>
        }
        <tr>
            <td>
                Total
            </td>
            <td>
                @Model.JudgingCriteria.Sum(jc => jc.MaxPoints)
            </td>
            @foreach (var project in Model.Projects)
            {
                <td data-project-id="@project.Id" class="project-total-points">
                    @Model.InitialPoints.Where(p => p.Project.Id == project.Id).Sum(jc => jc.Points)
                </td>
            }
        </tr>
        </tbody>
    </table>
</div>

@using (Html.BeginMStyles())
{
    <link rel="stylesheet" href="~/judging/judging.css"/>
}

@using (Html.BeginMPageScripts())
{
    <script src="~/judging/judging.js" asp-append-version="true"></script>
}